---
allowed-tools: Bash, Write
description: Export SQLite database to JSON or individual task markdown files
argument-hint: "[--tasks | --memories | --all | --files] [output-file]"
---

# Export Command

You are implementing `taskmanager:export`.

## Purpose

Export taskmanager data to JSON format for inspection, sharing, or backup. Also supports generating individual markdown files per task for documentation and code review.

## Arguments

- `--tasks` - Export tasks as JSON
- `--memories` - Export memories as JSON
- `--all` - Export everything as JSON (default)
- `--files` - Generate individual markdown files per task
- `--include-archived` - Include archived tasks in export
- `[output-file]` - Output file path for JSON modes (default: stdout)

## Behavior

### Export tasks (JSON)

```bash
sqlite3 -json .taskmanager/taskmanager.db "
SELECT * FROM tasks WHERE archived_at IS NULL ORDER BY id;
" | jq '{
    version: "4.0.0",
    exported_at: (now | todate),
    tasks: .
}'
```

If `--include-archived` is specified, remove the `WHERE archived_at IS NULL` filter.

### Export memories (JSON)

```bash
sqlite3 -json .taskmanager/taskmanager.db "
SELECT * FROM memories ORDER BY id;
" | jq '{
    version: "4.0.0",
    exported_at: (now | todate),
    memories: .
}'
```

### Export all (JSON)

```bash
{
    echo '{"version": "4.0.0", "exported_at": "'$(date -Iseconds)'",'
    echo '"tasks": '
    sqlite3 -json .taskmanager/taskmanager.db "SELECT * FROM tasks ORDER BY id;"
    echo ','
    echo '"memories": '
    sqlite3 -json .taskmanager/taskmanager.db "SELECT * FROM memories ORDER BY id;"
    echo ','
    echo '"deferrals": '
    sqlite3 -json .taskmanager/taskmanager.db "SELECT * FROM deferrals ORDER BY id;"
    echo ','
    echo '"milestones": '
    sqlite3 -json .taskmanager/taskmanager.db "SELECT * FROM milestones ORDER BY phase_order;"
    echo ','
    echo '"plan_analyses": '
    sqlite3 -json .taskmanager/taskmanager.db "SELECT * FROM plan_analyses ORDER BY id;"
    echo ','
    echo '"state": '
    sqlite3 -json .taskmanager/taskmanager.db "SELECT * FROM state;"
    echo '}'
} | jq '.'
```

### Export individual task files (--files)

Generate one markdown file per task in `.taskmanager/docs/tasks/`.

1. **Create output directory**:
   ```bash
   mkdir -p .taskmanager/docs/tasks
   ```

2. **Query all active tasks**:
   ```sql
   SELECT id, parent_id, title, description, details, test_strategy,
          status, type, priority,
          complexity_scale, complexity_reasoning,
          estimate_seconds, duration_seconds,
          started_at, completed_at,
          tags, dependencies,
          milestone_id, acceptance_criteria, moscow, business_value, dependency_types
   FROM tasks
   WHERE archived_at IS NULL
   ORDER BY id;
   ```

   If `--include-archived` is specified, remove the `WHERE` filter.

3. **For each task**, generate a markdown file at `.taskmanager/docs/tasks/task-<id>.md`:

   ```markdown
   # Task <id>: <title>

   | Field | Value |
   |-------|-------|
   | **Status** | <status> |
   | **Priority** | <priority> |
   | **Type** | <type> |
   | **Complexity** | <complexity_scale> |
   | **Estimate** | <estimate formatted as hours> |
   | **Dependencies** | <comma-separated list or "None"> |
   | **Tags** | <comma-separated list or "None"> |
   | **Milestone** | <milestone_id or "None"> |
   | **MoSCoW** | <moscow or "Unset"> |
   | **Business Value** | <business_value or "Unset"> |

   ## Acceptance Criteria

   <For each criterion in acceptance_criteria JSON array:>
   - [ ] <criterion>
   <Or "No acceptance criteria defined" if empty>

   ## Description

   <description>

   ## Implementation Details

   <details>

   ## Test Strategy

   <test_strategy>

   ## Subtasks

   <For each child task:>
   - [ ] <child-id>: <child-title> [<child-status>]
   <Or "No subtasks" if none>

   ---
   *Generated by taskmanager:export --files on <timestamp>*
   ```

   File naming: Replace dots in ID with dashes for the filename.
   - Task `1.2.3` -> `task-1-2-3.md`

4. **Generate index file** at `.taskmanager/docs/tasks/README.md`:

   ```markdown
   # Task Index

   Generated on <timestamp>

   ## Overview

   | Metric | Value |
   |--------|-------|
   | Total Tasks | <count> |
   | Completed | <done-count> (<percent>%) |
   | Remaining | <remaining-count> |

   ## Tasks

   | ID | Title | Status | Priority | Complexity |
   |----|-------|--------|----------|------------|
   | [1](task-1.md) | <title> | <status> | <priority> | <complexity> |
   | [1.1](task-1-1.md) | <title> | <status> | <priority> | <complexity> |
   ...
   ```

5. **Report to user**:
   ```
   Exported N task files to .taskmanager/docs/tasks/
   Index file: .taskmanager/docs/tasks/README.md
   ```

### Output to file

If output-file is specified (for JSON modes):
```bash
# ... export command ... > output-file.json
echo "Exported to output-file.json"
```

## Notes

- JSON export is useful for debugging, sharing project state, or creating backups
- File export is useful for documentation, code review, and sharing task details outside the CLI
- Output is valid JSON that could be re-imported if needed
- Task files use dots-to-dashes conversion for filenames (1.2.3 -> task-1-2-3.md)

## Usage Examples

```bash
# Export all as JSON to stdout
taskmanager:export

# Export tasks to a file
taskmanager:export --tasks output.json

# Generate individual task files
taskmanager:export --files

# Generate files including archived tasks
taskmanager:export --files --include-archived
```

---

## Related Commands

- `taskmanager:show --stats` - View quick statistics
- `taskmanager:show` - View progress dashboard
- `taskmanager:show <id>` - View single task details
