{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "MWGuerraTasks",
  "type": "object",
  "required": ["version", "tasks"],
  "properties": {
    "version": { "type": "string" },
    "project": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },
    "tasks": {
      "type": "array",
      "items": { "$ref": "#/$defs/task" }
    }
  },
  "$defs": {
    "task": {
      "type": "object",
      "required": ["id", "title", "status", "priority", "complexity", "subtasks"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)*$"
        },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "status": {
          "type": "string",
          "enum": [
            "draft",
            "planned",
            "in-progress",
            "blocked",
            "paused",
            "done",
            "canceled",
            "duplicate",
            "needs-review"
          ]
        },
        "type": {
          "type": "string",
          "enum": ["feature", "bug", "chore", "analysis", "spike"]
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "complexity": {
          "type": "object",
          "required": ["score"],
          "properties": {
            "score": { "type": "number", "minimum": 0, "maximum": 5 },
            "scale": {
              "type": "string",
              "enum": ["XS", "S", "M", "L", "XL"]
            },
            "reasoning": { "type": "string" },
            "recommendedSubtasks": { "type": "integer", "minimum": 0 },
            "expansionPrompt": { "type": "string" }
          },
          "additionalProperties": false
        },
        "domain": {
          "type": "string",
          "enum": ["software", "writing"],
          "description": "High-level domain this task belongs to. If omitted, treat as 'software' by default."
        },
        "writingType": {
          "type": ["string", "null"],
          "enum": ["book", "article", "blog-post", "short-story", "novella", "documentation", "whitepaper", "other"],
          "description": "Specific format for writing-related tasks. Only relevant when domain = 'writing'."
        },
        "contentUnit": {
          "type": ["string", "null"],
          "enum": ["work", "part", "chapter", "section", "subsection", "scene", "appendix", "front-matter", "back-matter", "other"],
          "description": "If this task applies to a specific unit of the work (e.g. chapter, scene)."
        },
        "targetWordCount": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Approximate word-count target for the content covered by this task (for writing domain)."
        },
        "currentWordCount": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Optional: current word count achieved so far for this task's content. Not required, but useful for progress tracking."
        },
        "writingStage": {
          "type": ["string", "null"],
          "enum": ["idea", "outline", "research", "draft", "rewrite", "edit", "copyedit", "proofread", "ready-to-publish", "published"],
          "description": "Fine-grained stage inside the writing process; complements the generic status field."
        },
        "dependencies": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dependencyAnalysis": {
          "type": "object",
          "properties": {
            "blockedBy": {
              "type": "array",
              "items": { "type": "string" }
            },
            "blocks": {
              "type": "array",
              "items": { "type": "string" }
            },
            "conflictsWith": {
              "type": "array",
              "items": { "type": "string" }
            },
            "notes": { "type": "string" }
          },
          "additionalProperties": false
        },
        "parentId": { "type": ["string", "null"] },
        "owner": { "type": "string" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "details": { "type": "string" },
        "testStrategy": { "type": "string" },
        "estimateSeconds": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Estimated effort for this task in seconds. Leaf tasks MUST have a non-null value. Parent tasks SHOULD have the sum of their direct children."
        },
        "startedAt": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When execution of this task actually started."
        },
        "completedAt": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When this task first reached a terminal status (done/canceled/duplicate)."
        },
        "durationSeconds": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Actual elapsed execution time in seconds, computed when the task reaches a terminal status."
        },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "meta": { "type": "object" },
        "subtasks": {
          "type": "array",
          "items": { "$ref": "#/$defs/task" }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
