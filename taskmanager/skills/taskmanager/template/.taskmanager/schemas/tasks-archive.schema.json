{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "MWGuerraTasksArchive",
  "description": "Schema for archived tasks. Contains full task objects moved from tasks.json when they reach terminal status.",
  "type": "object",
  "required": ["version", "tasks"],
  "properties": {
    "version": { "type": "string" },
    "project": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },
    "lastUpdated": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "When the last task was archived or un-archived."
    },
    "tasks": {
      "type": "array",
      "items": { "$ref": "#/$defs/archivedTask" }
    }
  },
  "$defs": {
    "archivedTask": {
      "type": "object",
      "required": ["id", "title", "status", "priority", "complexity", "subtasks", "archivedAt"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)*$"
        },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "status": {
          "type": "string",
          "enum": [
            "done",
            "canceled",
            "duplicate"
          ],
          "description": "Archived tasks must have terminal status."
        },
        "type": {
          "type": "string",
          "enum": ["feature", "bug", "chore", "analysis", "spike"]
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "complexity": {
          "type": "object",
          "required": ["score"],
          "properties": {
            "score": { "type": "number", "minimum": 0, "maximum": 5 },
            "scale": {
              "type": "string",
              "enum": ["XS", "S", "M", "L", "XL"]
            },
            "reasoning": { "type": "string" },
            "recommendedSubtasks": { "type": "integer", "minimum": 0 },
            "expansionPrompt": { "type": "string" }
          },
          "additionalProperties": false
        },
        "domain": {
          "type": "string",
          "enum": ["software", "writing"]
        },
        "writingType": {
          "type": ["string", "null"],
          "enum": ["book", "article", "blog-post", "short-story", "novella", "documentation", "whitepaper", "other"]
        },
        "contentUnit": {
          "type": ["string", "null"],
          "enum": ["work", "part", "chapter", "section", "subsection", "scene", "appendix", "front-matter", "back-matter", "other"]
        },
        "targetWordCount": {
          "type": ["integer", "null"],
          "minimum": 0
        },
        "currentWordCount": {
          "type": ["integer", "null"],
          "minimum": 0
        },
        "writingStage": {
          "type": ["string", "null"],
          "enum": ["idea", "outline", "research", "draft", "rewrite", "edit", "copyedit", "proofread", "ready-to-publish", "published"]
        },
        "dependencies": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dependencyAnalysis": {
          "type": "object",
          "properties": {
            "blockedBy": {
              "type": "array",
              "items": { "type": "string" }
            },
            "blocks": {
              "type": "array",
              "items": { "type": "string" }
            },
            "conflictsWith": {
              "type": "array",
              "items": { "type": "string" }
            },
            "notes": { "type": "string" }
          },
          "additionalProperties": false
        },
        "parentId": { "type": ["string", "null"] },
        "owner": { "type": "string" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "details": { "type": "string" },
        "testStrategy": { "type": "string" },
        "estimateSeconds": {
          "type": ["integer", "null"],
          "minimum": 0
        },
        "startedAt": {
          "type": ["string", "null"],
          "format": "date-time"
        },
        "completedAt": {
          "type": ["string", "null"],
          "format": "date-time"
        },
        "durationSeconds": {
          "type": ["integer", "null"],
          "minimum": 0
        },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "meta": { "type": "object" },
        "subtasks": {
          "type": "array",
          "items": { "$ref": "#/$defs/archivedTask" }
        },
        "archivedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When this task was archived."
        },
        "unarchivedAt": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When this task was restored from archive (if applicable)."
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
